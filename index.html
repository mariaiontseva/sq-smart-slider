<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Infinite Dots ‚Äî Image Carousel</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #f2f2f7;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
    color: #1c1c1e;
    gap: 20px;
    padding: 20px 0;
  }

  /* --- Slide count selector --- */
  .selector-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #fff;
    padding: 8px 16px;
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  }

  .selector-label {
    font-size: 13px;
    font-weight: 600;
    color: #8e8e93;
    margin-right: 4px;
  }

  .selector-btn {
    width: 40px;
    height: 36px;
    border-radius: 10px;
    border: none;
    background: #f2f2f7;
    color: #3a3a3c;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
  }

  .selector-btn:hover {
    background: #e5e5ea;
  }

  .selector-btn.active {
    background: #007AFF;
    color: #fff;
  }

  .phone-frame {
    width: 375px;
    height: 750px;
    background: #fff;
    border-radius: 44px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 0 0 2px #d1d1d6, 0 40px 100px rgba(0,0,0,0.18);
    flex-shrink: 0;
  }

  /* --- Image area --- */
  .image-carousel {
    width: 100%;
    height: 420px;
    position: relative;
    overflow: hidden;
    background: #e5e5ea;
  }

  .image-track {
    display: flex;
    height: 100%;
    transition: transform 0.45s cubic-bezier(0.25, 0.1, 0.25, 1);
    will-change: transform;
  }

  .image-track.dragging {
    transition: none;
  }

  .image-slide {
    min-width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    user-select: none;
    -webkit-user-select: none;
    position: relative;
  }

  /* --- Arrow buttons --- */
  .arrow-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(0,0,0,0.35);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: none;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 15;
    transition: opacity 0.25s ease, background 0.2s ease;
    padding: 0;
  }

  .arrow-btn:hover { background: rgba(0,0,0,0.55); }
  .arrow-btn:active { transform: translateY(-50%) scale(0.92); }
  .arrow-btn.hidden { opacity: 0; pointer-events: none; }
  .arrow-left { left: 12px; }
  .arrow-right { right: 12px; }

  .arrow-btn svg {
    width: 18px;
    height: 18px;
    stroke: #fff;
    stroke-width: 2.2;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  /* --- Counter badge --- */
  .counter-badge {
    position: absolute;
    top: 56px;
    right: 20px;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    color: #fff;
    font-size: 13px;
    font-weight: 500;
    padding: 4px 10px;
    border-radius: 12px;
    font-variant-numeric: tabular-nums;
    z-index: 10;
    letter-spacing: 0.3px;
  }

  /* --- Smart Dots --- */
  .dots-container {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 5px;
    height: 10px;
    z-index: 10;
  }

  .dot {
    border-radius: 50%;
    transition: all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
    will-change: width, height, opacity, background-color;
    flex-shrink: 0;
    cursor: pointer;
  }

  /* --- Content area --- */
  .content-area { padding: 20px 20px 0; }

  .content-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 6px;
    letter-spacing: -0.3px;
  }

  .content-subtitle {
    font-size: 14px;
    color: #8e8e93;
    line-height: 1.5;
    margin-bottom: 16px;
  }

  .content-meta { display: flex; gap: 12px; margin-bottom: 20px; }

  .meta-tag {
    font-size: 12px;
    color: #636366;
    background: #f2f2f7;
    padding: 5px 10px;
    border-radius: 8px;
    font-weight: 500;
  }

  .content-divider {
    height: 1px;
    background: #e5e5ea;
    margin: 0 -20px 16px;
  }

  .content-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
  }

  .content-row-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    background: #f2f2f7;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
  }

  .content-row-text { font-size: 14px; color: #3a3a3c; line-height: 1.4; }
  .content-row-label { font-size: 11px; color: #aeaeb2; text-transform: uppercase; letter-spacing: 0.5px; }

  /* --- Bottom bar --- */
  .bottom-bar {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 84px;
    background: #fff;
    border-top: 1px solid #e5e5ea;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 12px;
  }

  .btn-primary {
    background: #007AFF;
    color: #fff;
    border: none;
    border-radius: 14px;
    font-size: 16px;
    font-weight: 600;
    padding: 14px 0;
    flex: 1;
    margin: 0 20px;
    cursor: pointer;
  }

  /* --- State info --- */
  .state-info {
    background: #fff;
    padding: 12px 20px;
    border-radius: 14px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    font-size: 12px;
    color: #636366;
    text-align: center;
    line-height: 1.6;
    max-width: 375px;
  }

  .state-info strong {
    color: #1c1c1e;
    font-weight: 600;
  }

  .state-info .blue { color: #007AFF; }

  .nav-hint {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 11px;
    color: #aeaeb2;
  }

  .nav-hint kbd {
    display: inline-block;
    background: #fff;
    border: 1px solid #d1d1d6;
    border-radius: 4px;
    padding: 1px 6px;
    font-family: inherit;
    font-size: 10px;
    color: #8e8e93;
  }
</style>
</head>
<body>

<!-- Slide count selector -->
<div class="selector-bar">
  <span class="selector-label">Slides:</span>
  <button class="selector-btn" data-count="1">1</button>
  <button class="selector-btn" data-count="2">2</button>
  <button class="selector-btn" data-count="3">3</button>
  <button class="selector-btn" data-count="4">4</button>
  <button class="selector-btn" data-count="5">5</button>
  <button class="selector-btn" data-count="6">6</button>
  <button class="selector-btn" data-count="7">7</button>
  <button class="selector-btn" data-count="8">8</button>
  <button class="selector-btn" data-count="9">9</button>
  <button class="selector-btn" data-count="10">10</button>
  <button class="selector-btn" data-count="20">20</button>
  <button class="selector-btn" data-count="50">50</button>
  <button class="selector-btn active" data-count="100">100</button>
</div>

<div class="phone-frame">
  <div class="image-carousel" id="viewport">
    <div class="image-track" id="track"></div>
    <button class="arrow-btn arrow-left hidden" id="arrowLeft">
      <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <button class="arrow-btn arrow-right" id="arrowRight">
      <svg viewBox="0 0 24 24"><polyline points="9 6 15 12 9 18"/></svg>
    </button>
    <div class="counter-badge" id="counter">1/100</div>
    <div class="dots-container" id="dots"></div>
  </div>

  <div class="content-area">
    <div class="content-title">Sakura Garden Restaurant</div>
    <div class="content-subtitle">Japanese fine dining with seasonal tasting menus and a tranquil garden setting.</div>
    <div class="content-meta">
      <div class="meta-tag">‚òÖ 4.8</div>
      <div class="meta-tag">$$$$</div>
      <div class="meta-tag">Japanese</div>
      <div class="meta-tag">1.2 km</div>
    </div>
    <div class="content-divider"></div>
    <div class="content-row">
      <div class="content-row-icon">üìç</div>
      <div>
        <div class="content-row-text">42 Blossom Lane, Kensington</div>
        <div class="content-row-label">Address</div>
      </div>
    </div>
    <div class="content-row">
      <div class="content-row-icon">üïê</div>
      <div>
        <div class="content-row-text">Open until 22:30</div>
        <div class="content-row-label">Hours</div>
      </div>
    </div>
    <div class="content-row">
      <div class="content-row-icon">üìû</div>
      <div>
        <div class="content-row-text">+44 20 7946 0958</div>
        <div class="content-row-label">Reservations</div>
      </div>
    </div>
  </div>

  <div class="bottom-bar">
    <button class="btn-primary">Reserve a Table</button>
  </div>
</div>

<!-- State description -->
<div class="state-info" id="stateInfo"></div>

<div class="nav-hint"><kbd>‚Üê</kbd> <kbd>‚Üí</kbd> arrows or swipe</div>

<script>
const ACTIVE_COLOUR = '#007AFF';
const DEFAULT_COLOUR = 'rgba(255,255,255,0.7)';

function dotStyle(distance, total) {
  // For <= 7 slides, all dots are full size (no shrinking needed)
  if (total <= 7) {
    if (distance === 0) return { size: 8, colour: ACTIVE_COLOUR, opacity: 1 };
    return { size: 8, colour: DEFAULT_COLOUR, opacity: 1 };
  }
  // For > 7 slides, use smart infinite scaling
  if (distance === 0) return { size: 8, colour: ACTIVE_COLOUR, opacity: 1 };
  if (distance === 1) return { size: 7, colour: DEFAULT_COLOUR, opacity: 1 };
  if (distance === 2) return { size: 5, colour: DEFAULT_COLOUR, opacity: 0.8 };
  if (distance === 3) return { size: 3.5, colour: DEFAULT_COLOUR, opacity: 0.45 };
  return { size: 0, colour: DEFAULT_COLOUR, opacity: 0 };
}

const track = document.getElementById('track');
const dotsContainer = document.getElementById('dots');
const arrowLeft = document.getElementById('arrowLeft');
const arrowRight = document.getElementById('arrowRight');
const counterEl = document.getElementById('counter');
const stateInfoEl = document.getElementById('stateInfo');
const viewport = document.getElementById('viewport');

let totalSlides = 100;
let current = 0;
let dots = [];

function buildCarousel(count) {
  totalSlides = count;
  current = 0;

  // Clear
  track.innerHTML = '';
  dotsContainer.innerHTML = '';
  dots = [];

  // Build slides
  for (let i = 0; i < count; i++) {
    const slide = document.createElement('div');
    slide.className = 'image-slide';
    slide.style.backgroundImage = `url(https://picsum.photos/seed/s${i + 1}/750/840)`;
    const hue = (i * (360 / count)) % 360;
    slide.style.backgroundColor = `hsl(${hue}, 30%, 45%)`;
    track.appendChild(slide);
  }

  // Build dots
  for (let i = 0; i < count; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot';
    dot.addEventListener('click', () => goTo(i));
    dotsContainer.appendChild(dot);
    dots.push(dot);
  }

  goTo(0);
}

function updateDots(page) {
  dots.forEach((dot, i) => {
    const distance = Math.abs(i - page);
    const s = dotStyle(distance, totalSlides);
    dot.style.width = s.size + 'px';
    dot.style.height = s.size + 'px';
    dot.style.backgroundColor = s.colour;
    dot.style.opacity = s.opacity;
    dot.style.margin = s.size === 0 ? '0 -2.5px' : '0';
  });
}

function updateArrows(page) {
  arrowLeft.classList.toggle('hidden', page === 0);
  arrowRight.classList.toggle('hidden', page === totalSlides - 1);
}

function updateCounter(page) {
  counterEl.textContent = `${page + 1}/${totalSlides}`;
}

function updateStateInfo(page) {
  const mode = totalSlides <= 7 ? 'Simple mode' : 'Smart infinite mode';
  const dotCount = totalSlides <= 7
    ? `All ${totalSlides} dots shown at full size`
    : `Visible: ~7 dots, hidden: ${Math.max(0, totalSlides - 7)}`;

  let html = `<strong>${mode}</strong> &middot; ${totalSlides} slides<br>`;
  html += `${dotCount}<br>`;

  if (totalSlides > 7) {
    const labels = [];
    for (let d = 0; d <= 4; d++) {
      const idx = page + d;
      const idxNeg = page - d;
      if (d === 0) {
        labels.push(`<span class="blue">‚óè</span> #${page + 1} active 8px`);
      } else {
        const s = dotStyle(d, totalSlides);
        if (s.size > 0) {
          const positions = [];
          if (idxNeg >= 0) positions.push(`#${idxNeg + 1}`);
          if (idx < totalSlides) positions.push(`#${idx + 1}`);
          if (positions.length) {
            labels.push(`‚óã ${positions.join(', ')} = ${s.size}px @ ${Math.round(s.opacity * 100)}%`);
          }
        }
      }
    }
    html += labels.join(' &middot; ');
  }

  stateInfoEl.innerHTML = html;
}

function goTo(page) {
  if (page < 0 || page >= totalSlides) return;
  current = page;
  track.style.transform = `translateX(-${current * 100}%)`;
  updateDots(current);
  updateCounter(current);
  updateArrows(current);
  updateStateInfo(current);
}

// Selector buttons
document.querySelectorAll('.selector-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.selector-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    buildCarousel(parseInt(btn.dataset.count));
  });
});

// Keyboard
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight' || e.key === 'ArrowDown') goTo(current + 1);
  if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') goTo(current - 1);
});

// Arrows
arrowLeft.addEventListener('click', (e) => { e.stopPropagation(); goTo(current - 1); });
arrowRight.addEventListener('click', (e) => { e.stopPropagation(); goTo(current + 1); });

// Touch / mouse swipe
let startX = 0, isDragging = false, dragOffset = 0;
const slideWidth = () => viewport.offsetWidth;

function onDown(e) {
  if (e.target.closest('.arrow-btn')) return;
  isDragging = true;
  startX = (e.clientX !== undefined) ? e.clientX : e.touches[0].clientX;
  dragOffset = 0;
  track.classList.add('dragging');
}

function onMove(e) {
  if (!isDragging) return;
  const x = (e.clientX !== undefined) ? e.clientX : e.touches[0].clientX;
  dragOffset = x - startX;
  track.style.transform = `translateX(${-current * slideWidth() + dragOffset}px)`;
}

function onUp() {
  if (!isDragging) return;
  isDragging = false;
  track.classList.remove('dragging');
  const threshold = slideWidth() * 0.18;
  if (dragOffset < -threshold) goTo(current + 1);
  else if (dragOffset > threshold) goTo(current - 1);
  else goTo(current);
}

viewport.addEventListener('mousedown', onDown);
window.addEventListener('mousemove', onMove);
window.addEventListener('mouseup', onUp);
viewport.addEventListener('touchstart', onDown, { passive: true });
viewport.addEventListener('touchmove', onMove, { passive: true });
viewport.addEventListener('touchend', onUp);

// Init
buildCarousel(100);
</script>

</body>
</html>
